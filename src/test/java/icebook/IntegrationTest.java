package icebook;

import org.junit.Test;

import java.io.*;

import static org.junit.Assert.assertEquals;

/**
 * Tests the integration of the whole system.
 */
public final class IntegrationTest {

    @Test
    public void testIntegration() throws IOException {
        final String input
                = "# BUYS\n"
                + "B,1,99,50000\n"
                + "B,2,98,25500\n"
                + "\n"
                + "# SELLS\n"
                + "S,3,100,10000\n"
                + "S,4,100,7500\n"
                + "S,5,101,20000\n"
                + "\n"
                + "# Iceberg Order\n"
                + "B,6,100,100000,10000\n"
                + "\n"
                + "# Aggressive SELL LIMIT\n"
                + "S,7,100,10000\n"
                + "S,8,100,11000\n"
                + "\n"
                + "# Second Iceberg Order\n"
                + "B,9,100,50000,20000\n"
                + "\n"
                + "# Now aggressive SELL LIMIT enters book\n"
                + "S,10,100,35000";

        final String expectedOut
                = "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         1|       50,000|     99|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         1|       50,000|     99|       |             |          |\n"
                + "|         2|       25,500|     98|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         1|       50,000|     99|    100|       10,000|         3|\n"
                + "|         2|       25,500|     98|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         1|       50,000|     99|    100|       10,000|         3|\n"
                + "|         2|       25,500|     98|    100|        7,500|         4|\n"
                + "+-----------------------------------------------------------------+\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         1|       50,000|     99|    100|       10,000|         3|\n"
                + "|         2|       25,500|     98|    100|        7,500|         4|\n"
                + "|          |             |       |    101|       20,000|         5|\n"
                + "+-----------------------------------------------------------------+\n"
                + "6,3,100,10000\n"
                + "6,4,100,7500\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         6|       10,000|    100|    101|       20,000|         5|\n"
                + "|         1|       50,000|     99|       |             |          |\n"
                + "|         2|       25,500|     98|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n"
                + "6,7,100,10000\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         6|       10,000|    100|    101|       20,000|         5|\n"
                + "|         1|       50,000|     99|       |             |          |\n"
                + "|         2|       25,500|     98|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n"
                + "6,8,100,11000\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         6|        9,000|    100|    101|       20,000|         5|\n"
                + "|         1|       50,000|     99|       |             |          |\n"
                + "|         2|       25,500|     98|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         6|        9,000|    100|    101|       20,000|         5|\n"
                + "|         9|       20,000|    100|       |             |          |\n"
                + "|         1|       50,000|     99|       |             |          |\n"
                + "|         2|       25,500|     98|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n"
                + "6,10,100,15000\n"
                + "9,10,100,20000\n"
                + "+-----------------------------------------------------------------+\n"
                + "| BUY                            | SELL                           |\n"
                + "| Id       | Volume      | Price | Price | Volume      | Id       |\n"
                + "+----------+-------------+-------+-------+-------------+----------+\n"
                + "|         6|        4,000|    100|    101|       20,000|         5|\n"
                + "|         9|       20,000|    100|       |             |          |\n"
                + "|         1|       50,000|     99|       |             |          |\n"
                + "|         2|       25,500|     98|       |             |          |\n"
                + "+-----------------------------------------------------------------+\n";

        final StringReader in = new StringReader(input);
        final StringWriter out = new StringWriter(expectedOut.length());
        new Main(new BufferedReader(in), new PrintWriter(out)).run();

        assertEquals(expectedOut, out.toString());
    }
}
